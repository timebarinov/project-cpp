# Транспортный справочник, часть K. Сжатие координат со склейкой соседних

### Условие

Улучшим алгоритм сжатия координат с использованием следующей идеи: если соседние в отсортированном наборе долготы (или широты) не связаны напрямую отрезком автобусного маршрута, проходящего через соответствующие остановки, этим долготам (широтам) можно поставить в соответствие одинаковый номер и, как следствие, одинаковую x-координату (y-координату).

**Нумерация координат**

Разберём алгоритм нумерации долгот по отсортированному массиву их значений.

Первая (минимальная) долгота получает номер 0. Далее, перебирая долго́ты по возрастанию, для очередной долготы́ выбираем, нужно ли ей присвоить такой же номер, как предыдущей, или нужно завершить группу долгот, соответствующих одной x-координате, и присвоить текущей долготе номер, на единицу больший номера предыдущей.

Обозначим номер предыдущей долготы за idx. Текущей долготе нужно присвоить тот же номер idx, если ни одна из предыдущих долгот с номером idx не является маршрутным соседом текущей долготы. Маршрутными соседями будем называть пары долгот, которым соответствуют остановки, являющиеся соседними остановками какого-либо маршрута.

Алгоритм для широт полностью аналогичен.

**Отображение координат**

В этой части изменения минимальны:

1. x_step и y_step вычисляются с помощью номеров последней долготы (max_lon_idx) и последней широты (max_lat_idx): x_step = (width - 2 * padding) / max_lon_idx, y_step = (height - 2 * padding) / max_lat_idx. Как и прежде, в случае нулевого знаменателя можно считать результат выражения равным нулю.

2. Формулы для итоговых x- и y-координат полностью аналогичны и используют номера долгот и широт из предыдущего раздела.