# Транспортный справочник, часть N. Отрисовка маршрута

### Условие

В этой части вам необходимо добавить визуализацию построенных маршрутов.

**Формат вывода**

Новых запросов к базе не появляется. Для запросов типа Route необходимо выводить дополнительный ключ "map", содержащий SVG-документ в виде строки (аналогично запросу Map). Структура самой карты описана ниже.

**Расширение используемого подмножества формата SVG**

Необходимо поддержать новый SVG-объект — прямоугольник. Он выводится следующим образом:

    <rect x="x" y="y" width="w" height="h" path_props />

Здесь:

* x и y — координаты верхнего левого угла прямоугольника.

* w и h — ширина и высота.

* path_props — общие свойства объектов: цвета линии и заливки, толщина линии и формы конца линии и соединений.

Например, так выглядит квадрат с координатами углов (1, 1), (90, 90), с чёрной границей толщины 2 и белой заливкой:

    <rect x="1" y="1" width="89" height="89" fill="white" stroke="black" stroke-width="2" />

**Новая настройка отрисовки**

Добавляется новая настройка отрисовки:

Ключ | Описание | Формат значения | Гарантии
:-- | :--: | :--: | :--: 
outer_margin | Внешний отступ при выводе полупрозрачного прямоугольника, покрывающего карту для рисования маршрута поверх него | Вещественное число | Не меньше 0 и не больше 100000

**Отрисовка маршрута**

Рисование карты с маршрутом состоит из следующих этапов:

1. Выводим обычную карту целиком аналогично запросу Map, используя порядок слоёв, заданный настройкой layers.

2. Выводим полупрозрачный прямоугольник, покрывающий всю карту.

3. Выводим маршрут, используя порядок слоёв, заданный настройкой layers. Ниже описан порядок вывода каждого слоя.

**Вывод покрывающего карту прямоугольника**

На этапе 2 необходимо вывести прямогольник со следующими свойствами:

* Координата верхнего левого угла — (-outer_margin, -outer_margin).

* Координата нижнего правого угла — (width + outer_margin, height + outer_margin).

* Цвет заливки — underlayer_color.

* Цвет и толщина линий — дефолтные (см. часть F).


**Вывод маршрута, слой bus_lines**

При отрисовке маршрута рисуются те участки автобусных линий, через которые проходит этот маршрут.

Для каждого элемента маршрута типа Bus в порядке их упоминания в маршруте необходимо вывести отрезок ломаной, соответствующей нужному отрезку автобусной линии. Обратите внимание, что одна остановка может встречаться на одном маршруте несколько раз — этот случай нужно обработать корректно и отобразить нужный отрезок.

Способ вывода каждой ломаной аналогичен таковому в обычной карте.

**Вывод маршрута, слой bus_labels**

При отрисовке маршрута рисуются номера автобусов, соответствующие тем конечным, через которые проходит этот маршрут.

Для каждого элемента маршрута типа Bus в порядке их упоминания в маршруте необходимо проверить, являются ли начало или конец этого отрезка конечными остановками (с точки зрения слоя bus_labels). Если начало отрезка маршрута является конечной этого маршрута, необходимо вывести название автобуса у соответствующей остановки. Далее, если конец этого отрезка является конечной, необходимо вывести название автобуса у соответствующей остановки. Обратите внимание, что в случае, когда отрезок маршрута пролегает от конечной до конечной, названия автобуса выводятся в следующем порядке: сначала для остановки, где начинается отрезок конкретного маршрута, затем для остановки, где он заканчивается.

Способ вывода каждого названия аналогичен таковому в обычной карте.

**Вывод маршрута, слой stop_points**

При отрисовке маршрута рисуются круги остановок для тех участов автобусных линий, через которые проходит этот маршрут.

Для каждого элемента маршрута типа Bus в порядке их упоминания в маршруте необходимо вывести круги всех остановок, соответствующих нужному отрезку автобусной линии. Остановки должны выводится в порядке прохода через них текущего построенного маршрута.

Обратите внимание, что согласно описанному алгоритму пересадочные остановки будут выведены дважды: сначала для того автобуса, с которого делается пересадка, а затем для автобуса, на который осуществляется пересадка.

Способ вывода каждого круга аналогичен таковому в обычной карте.

**Вывод маршрута, слой stop_labels**

При отрисовке маршрута названия рисуются только для пересадочных остановок конкретного маршрута.

Для каждого элемента маршрута типа Wait в порядке их упоминания в маршруте необходимо вывести название соответствующей остановки. Поскольку последней остановке маршрута не соответствует элемент Wait, её название нужно дополнительно вывести в конце, после вывода остальных названий.

Способ вывода каждого названия аналогичен таковому в обычной карте.

Ограничения

Количество запросов Route не превосходит 50, ограничение по времени на один тест — 5 секунд, по памяти — 1 ГБ.

**Примеры**

Пример 1

[Ввод](https://d3c33hcgiwev3.cloudfront.net/HkfM46DZEemnpBK2VMQaIg_2b9e04a4c4d9435191128f189f1dc85f_example1.in?Expires=1649980800&Signature=VhW-ZNtCdsPqPKOAUsNbwATuYp6MFow07QSKT6bI8FZtwKti8j-ukL5yqWwjfY-wuDC-q3tUMYX6mGwIS28jRv6HeHivPL4DDNWxbqqMj3DcHSxFnavr~oX9vicFr6jxI6~Y2CYndVVAsVBstfkaX~fuCsVGS4ry-7RgfTAQEKw_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A)

[Вывод](https://d3c33hcgiwev3.cloudfront.net/HkgbNaDZEem7UA4S1V_t6g_ad319fafbcbc43148e73a7ffbf751154_example1.out?Expires=1649980800&Signature=VLsq61nVDpbHLE5yYiIesMW4QtoJtdVIvuf638ruFvigPMHuBTsW8ryAgGk0LjC0y2EF6Wi5fZMVjLjcYXHXDqZ9Ikzrhkw0DQAwQuHtxo3~aLPK7-kAq3iX7pTmLeZBsJB5Xf0YrVsE2mi4jQYNgrbH5tPnWZBz3ojXVkzTCA0_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A)

Пример 2

[Ввод](https://d3c33hcgiwev3.cloudfront.net/BOKmsn8EEemUJRIjvKFicg_68ff8a4ad8474b20ac64190869a18305_example2.in?Expires=1649980800&Signature=afsEFpvdpIoIs4LmnqiJRu9ats0jsbf2UBUJ1IEiHX7k7FkGRtELTlfrsrJ0xxeXxRhhUkv-eTmn2IbbfLziCUOi0BBigmVro2uAOnUXs2N03uV9rOqygz9X2ppNa~PaTPqAK7tmV8Em~OKdcvVr3-4rfzAwb-fFQk26Kkch~1o_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A)

[Вывод](https://d3c33hcgiwev3.cloudfront.net/BOL0en8EEemDJAqQ6uIUNA_caed5edeb1824a0e9ef5f94c6097cc45_example2.out?Expires=1649980800&Signature=Lfp08r2ZtkflSVk2m9gB27yKClcVxZeeS3RtKJI~o0iv16i9n~zhO2ncMHuGe~kQqB6Oy8u~x2Lmu3v~bb2HhVS7TiZRyRpoLPD7W5XrvsgOvTfj-1voTFCbSNLqJhQDlfhv9HTHpgqxmptGi9KJpLio09LMitnYIXVrl5mAb-s_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A)