# Транспортный справочник, часть L. Равномерное распределение промежуточных остановок

### Условие

Сделаем схему ещё более аккуратной, в очередной раз пожертвовав топографической достоверностью. А именно, перед вычислением проекций остановок нужно пересчитать координаты промежуточных остановок, расположив их равномерно между опорными остановками — пересадочными и конечными.

Итак, первым шагом зафиксируем опорные остановки: таковыми являются все конечные (возле которых рисуется номер автобуса), а также все пересадочные остановки, то есть те, через которые проходит более одного автобуса или через которые проходит один автобус, но более чем дважды за весь маршрут. У таких остановок географические координаты останутся прежними. Также не меняются координаты у остановок, через которые не проходит ни один автобус.

При выявлении опорных остановок считайте, что некольцевой маршрут проходит через каждую неконечную остановку чётное число раз: по пути в одну сторону и в обратную. Напомним, что некольцевой маршрут A→B эквивалентен кольцевому A→B→A во всех отношениях, кроме правила определения конечных: в первом случае конечными считаются A и B, тогда как во втором — только A.

Координаты остальных (промежуточных) остановок вычисляются следующим образом. Рассмотрим конкретный автобусный маршрут и опорные остановки на нём: это первая, последняя и, возможно, некоторые другие — они разбивают все промежуточные остановки на группы, и в рамках каждой такой группы промежуточные остановки нужно расположить равномерно между опорными. Пусть, например, на автобусном маршруте со списком остановок stops есть остановка номер i, являющаяся опорной,  следующая опорная после неё имеет номер j. Тогда для каждого k от i + 1 до j - 1 нужно вычислить новую долготу остановки stops[k] по формуле stops[i].lon + lon_step * (k - i), где lon_step = (stops[j].lon - stops[i].lon) / (j - i); формулы для широт аналогичны.

При этом возможны следующие особые случаи:

1. Кольцевой маршрут дважды проходит через одну неконечную остановку: согласно описанным выше правилам она не считается опорной, но есть два способа вычислить её координату. В этом случае считайте, что второй (в порядке обхода маршрута) способ вычисления координаты такой остановки более правильный: то есть достаточно итерироваться по всем остановкам маршрута и заполнять новые координаты для промежуточных, допуская, что новая координата может быть переопределена.

2. Кольцевой маршрут с одной опорной остановкой — конечной. Согласно алгоритму, все остановки такого маршрута должны оказаться в одной точке — так и поступайте.

Обратите внимание, что новые географические координаты промежуточных остановок влияют лишь на их положение на карте, но не на расстояние между ними, вычисляемое для запроса Bus.

Итоговый алгоритм вычисления координат остановок для схемы выглядит следующим образом:

1. Пересчёт географических координат остановок с использованием опорных.

2. Нумерация широт и долгот в порядке возрастания со склейкой соседей (из части K).

3. Вычисление x- и y-координат остановок с помощью сжатия координат согласно нумерации из п. 2.