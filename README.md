# Транспортный справочник, часть E

В этой задаче и последующих её версиях вам нужно реализовать систему хранения транспортных маршрутов и обработки запросов к ней. На вход программе подаётся JSON-объект, описывающий запросы на создание базы данных (ключ base_requests) и запросы к этой базе (ключ stat_requests). Выход программы также ожидается в формате JSON.

## Формат ввода базы данных

Запросы на создание объектов в базе данных задаются в виде списка в ключе base_requests входного JSON. Каждый запрос является словарём, содержащим ключ type — тип запроса, а также прочую дополнительную информацию о соответствующем объекте.

**Stop: описание остановки**

    {
        "type": "Stop",
        "name": "Tolstopaltsevo",
        "latitude": 55.611087,
        "longitude": 37.20829,
        "road_distances": {
        "Marushkino": 3900
        }
    }

По умолчанию предполагается, что расстояние от остановки A до остановки B равно расстоянию от B до A, если только расстояние от A до B не задано явным образом при добавлении остановки A.

Гарантируется, что каждая из остановок из road_distances определена в некотором запросе Stop.

В рамках одного запроса Stop все остановки различны, и их количество не превосходит 100.

Гарантируется, что каждая остановка определена не более чем в одном запросе Stop.

**Bus: описание автобуса**

    {
        "type": "Bus",
        "name": "750",
        "stops": [
          "Tolstopaltsevo",
          "Marushkino",
          "Rasskazovka"
        ],
        "is_roundtrip": false
    }

Запрос на добавление автобуса с названием, заданным в ключе name. Маршрут может задаваться в одном из двух форматов:

1. **"is_roundtrip": false:** автобус следует по списку остановок из stops от первой до последней и обратно.

2. **"is_roundtrip": true:** кольцевой маршрут, у которого первая остановка из списка stops является конечной.

По сути описание автобуса из последнего примера эквивалентно следующему:

    {
        "type": "Bus",
        "name": "750",
        "stops": [
            "Tolstopaltsevo",
            "Marushkino",
            "Rasskazovka",
            "Marushkino",
            "Tolstopaltsevo"
        ],
        "is_roundtrip": true
    }

Разница между двумя форматами лишь в том, что в первом случае последняя остановка считается конечной — но это важно лишь в части H и далее. С точки зрения механики маршрутизации выделяется лишь первая остановка, так как на ней пассажиры высаживаются из автобуса.

Гарантируется, что каждая из остановок маршрута определена в некотором запросе Stop, а сам автобус определён не более чем в одном запросе Bus.

## Секция routing_settings

Входной JSON содержит ключ routing_settings, значением которого является словарь с двумя ключами:

* "bus_wait_time" — время ожидания автобуса на остановке (в минутах). Считайте, что когда бы человек ни пришёл на остановку и какой бы ни была эта остановка, он будет ждать любой автобус в точности указанное количество минут. Значение — целое число от 1 до 1000.

* "bus_velocity" — скорость автобуса (в км/ч). Считайте, что скорость любого автобуса постоянна и в точности равна указанному числу. Время стоянки на остановках не учитывается, время разгона и торможения — тоже. Значение — вещественное число от 1 до 1000.

**Пример**

    "routing_settings": {
      "bus_wait_time": 6,
      "bus_velocity": 40
    }

Данная конфигурация задаёт время ожидания равным 6 минутам и скорость автобусов равной 40 километрам в час.

## Формат ввода базы данных

Запросы к базе данных задаются в виде списка в ключе stat_requests входного JSON. Каждый запрос является словарём, обязательно содержащим два ключа:

* type — тип запроса;

* id — целое число от 0 до 2147483647.

Ответы на запросы выводятся в виде списка, каждый элемент которого в поле request_id содержит id исходного запроса.

* **Bus: информация об автобусе**

**Пример:**

    {
        "route_length": 5950,
        "request_id": 1965312327,
        "curvature": 1.36124,
        "stop_count": 6,
        "unique_stop_count": 5
    }

* stop_count — количество остановок в кольцевой версии маршрута автобуса.

* unique_stop_count — количество уникальных остановок, на которых останавливается автобус. Одинаковыми считаются остановки, имеющие одинаковые названия.

* route_length — длина маршрута в метрах, вычисленная с использованием заданных выше расстояний по дорогам между остановками. Для простоты будем считать, что автобус проезжает путь между двумя соседними остановками по кратчайшему расстоянию по земной поверхности.

* curvature (извилистость) — отношение длины маршрута, вычисленной с помощью дорожного расстояния, к длине маршрута, вычисленной с помощью географического расстояния. (При вычислении расстояния между двумя точками на земной поверхности считайте число π равным 3.1415926535, а радиус Земли — 6371 км.) Таким образом, curvature — вещественное число, большее единицы. Оно может быть равно единице только в том случае, если автобус едет между остановками по кратчайшему пути (и тогда больше похож на вертолёт), а меньше единицы может оказаться только благодаря телепортации или хордовым тоннелям.

Гарантируется, что для любых двух соседних остановок любого маршрута так или иначе задано расстояние по дорогам.

Величину расстояния (а также другие вещественные числа в последующих частях задачи) выводите с 6 значащими цифрами, то есть предваряя модификатором setprecision(6). При этом ваши значения сравниваются с верными не посимвольно, а с относительной погрешностью 0,0001.

Если автобус не найден, выведите

    {
        "request_id": /* id запроса */,
        "error_message": "not found"
    }

* **Stop: информация об остановке**

**Пример:**

    {
        "buses": [
            "256",
            "828"
        ],
        "request_id": 1042838872
    }

buses — список автобусов (возможно, пустой), проходящих через эту остановку.

Если остановка не найдена, выведите

    {
        "request_id": /* id запроса */,
        "error_message": "not found"
    }

Route: построение маршрута между двумя остановками

Помимо стандартных свойств id и type, запросы содержат ещё два:

    from — остановка, в которой нужно начать маршрут.
    to — остановка, в которой нужно закончить маршрут.

Оба значения — названия существующих в базе остановок (однако, возможно, не принадлежащих ни одному автобусному маршруту).

**Пример:**

    {
        "type": "Route",
        "from": "Biryulyovo Zapadnoye",
        "to": "Universam",
        "id": 4
    }

Данный запрос означает построение маршрута от остановки «Biryulyovo Zapadnoye» до остановки «Universam».

На маршруте человек может использовать несколько автобусов, и даже один автобус несколько раз — если на некоторых участках он делает большой крюк и проще срезать на другом автобусе.

Маршрут должен быть наиболее оптимален по времени. Если маршрутов с минимально возможным суммарным временем несколько, допускается вывести любой из них: тестирующая система проверяет лишь совпадение времени маршрута с оптимальным и корректность самого маршрута.

При прохождении маршрута время расходуется на два типа активностей:

* Ожидание автобуса. Всегда длится bus_wait_time минут.
* Поездка на автобусе. Всегда длится ровно такое количество времени, которое требуется для преодоления данного расстояния со скоростью bus_velocity. Расстояние между остановками вычисляется по дорогам, то есть с помощью road_distances.

Ходить пешком, выпрыгивать из автобуса между остановками и использовать другие виды транспорта запрещается. На конечных остановках все автобусы высаживают пассажиров и уезжают в парк. Даже если человек едет на кольцевом ("is_roundtrip": true) маршруте и хочет проехать мимо конечной, он будет вынужден выйти и подождать тот же самый автобус ровно bus_wait_time минут. Этот и другие случаи разобраны в примерах.

Ответ на запрос Route устроен следующим образом:

    {
        "request_id": <id запроса>,
        "total_time": <суммарное время>,
        "items": [
            <элементы маршрута>
        ]
    }

total_time — суммарное время в минутах, требуемое для прохождения маршрута, выведенное в виде вещественного числа.

items — список элементов маршрута, каждый из которых описывает непрерывную активность пассажира, требующую временных затрат. А именно, элементы маршрута бывают двух типов.

Wait — подождать нужное количество минут (в нашем случае — всегда bus_wait_time) на указанной остановке:

    {
        "type": "Wait",
        "stop_name": "Biryulyovo",
        "time": 6
    }

Bus — проехать span_count остановок (перегонов между остановками) на автобусе bus, потратив указанное количество минут:  

    {
        "type": "Bus",
        "bus": "297",
        "span_count": 2,
        "time": 5.235
    }

В случае отсутствия маршрута между указанными остановками выведите результат в следующем формате:

    {
        "request_id": /* id запроса */,
        "error_message": "not found"
    }

#### Ввод

    {
        "routing_settings": {
            "bus_wait_time": 2,
            "bus_velocity": 30
        },
        "base_requests": [
            {
            "type": "Bus",
            "name": "289",
            "stops": [
                "Zagorye",
                "Lipetskaya ulitsa 46",
                "Lipetskaya ulitsa 40",
                "Lipetskaya ulitsa 40",
                "Lipetskaya ulitsa 46",
                "Moskvorechye",
                "Zagorye"
            ],
            "is_roundtrip": true
            },
            {
            "type": "Stop",
            "road_distances": {
                "Lipetskaya ulitsa 46": 230
            },
            "longitude": 37.68372,
            "name": "Zagorye",
            "latitude": 55.579909
            },
            {
            "type": "Stop",
            "road_distances": {
                "Lipetskaya ulitsa 40": 390,
                "Moskvorechye": 12400
            },
            "longitude": 37.682205,
            "name": "Lipetskaya ulitsa 46",
            "latitude": 55.581441
            },
            {
            "type": "Stop",
            "road_distances": {
                "Lipetskaya ulitsa 40": 1090,
                "Lipetskaya ulitsa 46": 380
            },
            "longitude": 37.679133,
            "name": "Lipetskaya ulitsa 40",
            "latitude": 55.584496
            },
            {
            "type": "Stop",
            "road_distances": {
                "Zagorye": 10000
            },
            "longitude": 37.638433,
            "name": "Moskvorechye",
            "latitude": 55.638433
            }
        ],
        "stat_requests": [
            {
            "type": "Bus",
            "name": "289",
            "id": 1
            },
            {
            "type": "Route",
            "from": "Zagorye",
            "to": "Moskvorechye",
            "id": 2
            },
            {
            "type": "Route",
            "from": "Moskvorechye",
            "to": "Zagorye",
            "id": 3
            },
            {
            "type": "Route",
            "from": "Lipetskaya ulitsa 40",
            "to": "Lipetskaya ulitsa 40",
            "id": 4
            }
        ]
    }

#### Вывод

    [
        {
            "unique_stop_count": 4,
            "stop_count": 7,
            "request_id": 1,
            "curvature": 1.63414,
            "route_length": 24490
        },
        {
            "total_time": 29.26,
            "items": [
                {
                    "time": 2,
                    "stop_name": "Zagorye",
                    "type": "Wait"
                },
                {
                    "time": 0.46,
                    "bus": "289",
                    "span_count": 1,
                    "type": "Bus"
                },
                {
                    "time": 2,
                    "stop_name": "Lipetskaya ulitsa 46",
                    "type": "Wait"
                },
                {
                    "time": 24.8,
                    "bus": "289",
                    "span_count": 1,
                    "type": "Bus"
                }
            ],
            "request_id": 2
        },
        {
            "total_time": 22,
            "items": [
                {
                    "time": 2,
                    "stop_name": "Moskvorechye",
                    "type": "Wait"
                },
                {
                    "time": 20,
                    "bus": "289",
                    "span_count": 1,
                    "type": "Bus"
                }
            ],
            "request_id": 3
        },
        {
            "total_time": 0,
            "items": [],
            "request_id": 4
        }
    ]